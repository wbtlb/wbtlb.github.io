<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>俄罗斯方块游戏</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    background: #111;
    color: #fff;
    font-family: sans-serif;
    height: 100vh;
    margin: 0;
    padding-top: 20px;
    flex-direction: column;
    align-items: center;
  }

  h1 { text-align: center; margin-bottom: 10px; }
  #game {
    position: relative;
    width: 200px;
    height: 400px;
    background: #222;
    border: 2px solid #fff;
  }

  .block {
    width: 20px;
    height: 20px;
    position: absolute;
  }

  #score {
    margin-top: 10px;
    font-size: 18px;
  }

  #controls {
    margin-top: 10px;
    font-size: 14px;
    color: #aaa;
  }
</style>
</head>
<body>
<h1>俄罗斯方块</h1>
<div id="game"></div>
<div id="score">得分: 0</div>
<div id="controls">
  控制: ← → 下，↑ 旋转，空格 快速下落
</div>

<script>
const COLS = 10, ROWS = 20, BLOCK = 20;
const gameEl = document.getElementById('game');
let scoreEl = document.getElementById('score');

const colors = ['#FF0D72','#0DC2FF','#0DFF72','#F538FF','#FF8E0D','#FFE138','#3877FF'];

const SHAPES = [
  [[1,1,1,1]], // I
  [[1,1],[1,1]], // O
  [[0,1,0],[1,1,1]], // T
  [[0,1,1],[1,1,0]], // S
  [[1,1,0],[0,1,1]], // Z
  [[1,0,0],[1,1,1]], // J
  [[0,0,1],[1,1,1]]  // L
];

let grid = Array.from({length: ROWS},()=>Array(COLS).fill(0));
let current = {}, gameInterval, score = 0;

function drawBlock(x, y, color) {
  const div = document.createElement('div');
  div.style.left = x*BLOCK+'px';
  div.style.top = y*BLOCK+'px';
  div.style.backgroundColor = color;
  div.className = 'block';
  gameEl.appendChild(div);
}

function draw() {
  gameEl.innerHTML = '';
  for(let r=0;r<ROWS;r++) {
    for(let c=0;c<COLS;c++) {
      if(grid[r][c]) drawBlock(c,r,colors[grid[r][c]-1]);
    }
  }
  if(current.shape) {
    for(let r=0;r<current.shape.length;r++) {
      for(let c=0;c<current.shape[r].length;c++) {
        if(current.shape[r][c]) drawBlock(current.x+c, current.y+r, colors[current.color-1]);
      }
    }
  }
}

function collision(xOff=0, yOff=0, newShape=null){
  const shape = newShape||current.shape;
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c]){
        const x = current.x+c+xOff, y=current.y+r+yOff;
        if(x<0 || x>=COLS || y>=ROWS) return true;
        if(y>=0 && grid[y][x]) return true;
      }
    }
  }
  return false;
}

function merge() {
  for(let r=0;r<current.shape.length;r++){
    for(let c=0;c<current.shape[r].length;c++){
      if(current.shape[r][c]){
        if(current.y+r>=0) grid[current.y+r][current.x+c]=current.color;
      }
    }
  }
}

function rotate(shape){
  return shape[0].map((_,i)=>shape.map(row=>row[i]).reverse());
}

function newPiece(){
  const id = Math.floor(Math.random()*SHAPES.length);
  current = {shape: SHAPES[id], x:3, y:-2, color:id+1};
  if(collision()) { alert('游戏结束! 得分: '+score); grid=Array.from({length: ROWS},()=>Array(COLS).fill(0)); score=0; scoreEl.innerText='得分: 0'; }
}

function drop(){
  if(!collision(0,1)) current.y++; else { merge(); clearLines(); newPiece(); }
  draw();
}

function clearLines(){
  for(let r=ROWS-1;r>=0;r--){
    if(grid[r].every(x=>x!==0)){
      grid.splice(r,1);
      grid.unshift(Array(COLS).fill(0));
      score += 10;
      scoreEl.innerText = '得分: '+score;
      r++;
    }
  }
}

document.addEventListener('keydown', e=>{
  if(!current.shape) return;
  switch(e.key){
    case 'ArrowLeft': if(!collision(-1,0)) current.x--; break;
    case 'ArrowRight': if(!collision(1,0)) current.x++; break;
    case 'ArrowDown': if(!collision(0,1)) current.y++; break;
    case 'ArrowUp': 
      const rotated = rotate(current.shape);
      if(!collision(0,0,rotated)) current.shape=rotated;
      break;
    case ' ': while(!collision(0,1)) current.y++; drop(); break;
  }
  draw();
});

newPiece();
gameInterval = setInterval(drop,500);
</script>
</body>
</html>
